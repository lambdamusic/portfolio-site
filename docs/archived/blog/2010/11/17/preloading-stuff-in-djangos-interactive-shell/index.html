<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
	<head profile="http://gmpg.org/xfn/11">
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<title>Parerga und Paralipomena  &raquo; Blog Archive   &raquo; Preloading stuff in django&#8217;s interactive shell		</title>
		<meta name="generator" content="WordPress 5.2.11" /> <!-- leave this for stats -->
		<link rel="stylesheet" href="../../../../wp-content/themes/ub_modio/style.css" type="text/css" media="screen" />
		<link rel="alternate" type="application/rss+xml" title="Parerga und Paralipomena RSS Feed" href="../../../../feed/index.html" />
		<link rel="pingback" href="http://www.michelepasin.org/blog/xmlrpc.php" />
		
		<!--[if lte IE 6]>
		<link rel="stylesheet" type="text/css" href="http://www.michelepasin.org/blog/wp-content/themes/ub_modio/ie.css">
		<![endif]-->
		<link rel="shortcut icon" href="http://www.michelepasin.org/blog/2010/11/17/preloading-stuff-in-djangos-interactive-shell/favicon.ico">
<link rel='dns-prefetch' href='http://secure.gravatar.com/' />
<link rel='dns-prefetch' href='http://s.w.org/' />
<link rel="alternate" type="application/rss+xml" title="Parerga und Paralipomena &raquo; Preloading stuff in django&#8217;s interactive shell Comments Feed" href="feed/index.html" />
<!-- This site uses the Google Analytics by MonsterInsights plugin v7.15.1 - Using Analytics tracking - https://www.monsterinsights.com/ -->
<script type="text/javascript" data-cfasync="false">
    (window.gaDevIds=window.gaDevIds||[]).push("dZGIzZG");
	var mi_version         = '7.15.1';
	var mi_track_user      = true;
	var mi_no_track_reason = '';
	
	var disableStr = 'ga-disable-UA-2000254-3';

	/* Function to detect opted out users */
	function __gaTrackerIsOptedOut() {
		return document.cookie.indexOf(disableStr + '=true') > -1;
	}

	/* Disable tracking if the opt-out cookie exists. */
	if ( __gaTrackerIsOptedOut() ) {
		window[disableStr] = true;
	}

	/* Opt-out function */
	function __gaTrackerOptout() {
	  document.cookie = disableStr + '=true; expires=Thu, 31 Dec 2099 23:59:59 UTC; path=/';
	  window[disableStr] = true;
	}

	if ( 'undefined' === typeof gaOptout ) {
		function gaOptout() {
			__gaTrackerOptout();
		}
	}
	
	if ( mi_track_user ) {
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','__gaTracker');

		__gaTracker('create', 'UA-2000254-3', 'auto');
		__gaTracker('set', 'forceSSL', true);
		__gaTracker('send','pageview');
	} else {
		console.log( "" );
		(function() {
			/* https://developers.google.com/analytics/devguides/collection/analyticsjs/ */
			var noopfn = function() {
				return null;
			};
			var noopnullfn = function() {
				return null;
			};
			var Tracker = function() {
				return null;
			};
			var p = Tracker.prototype;
			p.get = noopfn;
			p.set = noopfn;
			p.send = noopfn;
			var __gaTracker = function() {
				var len = arguments.length;
				if ( len === 0 ) {
					return;
				}
				var f = arguments[len-1];
				if ( typeof f !== 'object' || f === null || typeof f.hitCallback !== 'function' ) {
					console.log( 'Not running function __gaTracker(' + arguments[0] + " ....) because you are not being tracked. " + mi_no_track_reason );
					return;
				}
				try {
					f.hitCallback();
				} catch (ex) {

				}
			};
			__gaTracker.create = function() {
				return new Tracker();
			};
			__gaTracker.getByName = noopnullfn;
			__gaTracker.getAll = function() {
				return [];
			};
			__gaTracker.remove = noopfn;
			window['__gaTracker'] = __gaTracker;
					})();
		}
</script>
<!-- / Google Analytics by MonsterInsights -->
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/12.0.0-1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/12.0.0-1\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/www.michelepasin.org\/blog\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.2.11"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])?!1:!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([55357,56424,55356,57342,8205,55358,56605,8205,55357,56424,55356,57340],[55357,56424,55356,57342,8203,55358,56605,8203,55357,56424,55356,57340])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='wp-block-library-css'  href='../../../../wp-includes/css/dist/block-library/style.min.css%3Fver=5.2.11.css' type='text/css' media='all' />
<style id='wp-block-library-inline-css' type='text/css'>
.has-text-align-justify{text-align:justify;}
</style>
<link rel='stylesheet' id='ctf_styles-css'  href='../../../../wp-content/plugins/custom-twitter-feeds/css/ctf-styles.min.css%3Fver=1.7.css' type='text/css' media='all' />
<link rel='stylesheet' id='monsterinsights-popular-posts-style-css'  href='../../../../wp-content/plugins/google-analytics-for-wordpress/assets/css/frontend.min.css%3Fver=7.15.1.css' type='text/css' media='all' />
<link rel='stylesheet' id='wordpress-popular-posts-css-css'  href='../../../../wp-content/plugins/wordpress-popular-posts/assets/css/wpp.css%3Fver=5.2.4.css' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack_css-css'  href='../../../../wp-content/plugins/jetpack/css/jetpack.css%3Fver=8.1.2.css' type='text/css' media='all' />
<script type='text/javascript'>
/* <![CDATA[ */
var monsterinsights_frontend = {"js_events_tracking":"true","download_extensions":"doc,pdf,ppt,zip,xls,docx,pptx,xlsx","inbound_paths":"[]","home_url":"http:\/\/www.michelepasin.org\/blog","hash_tracking":"false"};
/* ]]> */
</script>
<script type='text/javascript' src='../../../../wp-content/plugins/google-analytics-for-wordpress/assets/js/frontend.min.js%3Fver=7.15.1'></script>
<script type='application/json' id="wpp-json">
{"sampling_active":0,"sampling_rate":100,"ajax_url":"http:\/\/www.michelepasin.org\/blog\/wp-json\/wordpress-popular-posts\/v1\/popular-posts","ID":1012,"token":"10a27ddbef","lang":0,"debug":0}
</script>
<script type='text/javascript' src='../../../../wp-content/plugins/wordpress-popular-posts/assets/js/wpp.min.js%3Fver=5.2.4'></script>
<script type='text/javascript' src='../../../../wp-includes/js/jquery/jquery.js%3Fver=1.12.4-wp'></script>
<script type='text/javascript' src='../../../../wp-includes/js/jquery/jquery-migrate.min.js%3Fver=1.4.1'></script>
<link rel='https://api.w.org/' href='../../../../wp-json/index.html' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../../../xmlrpc.php%3Frsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../../../../wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Ryoji Ikeda' href='../../09/ryoji-ikeda/index.html' />
<link rel='next' title='Clojure or not clojure?' href='../../25/clojure-or-not-clojure/index.html' />
<meta name="generator" content="WordPress 5.2.11" />
<link rel="canonical" href="index.html" />
<link rel='shortlink' href='https://wp.me/pW0Ls-gk' />
<link rel="alternate" type="application/json+oembed" href="../../../../wp-json/oembed/1.0/embed%3Furl=http:%252F%252Fwww.michelepasin.org%252Fblog%252F2010%252F11%252F17%252Fpreloading-stuff-in-djangos-interactive-shell%252F" />
<link rel="alternate" type="text/xml+oembed" href="../../../../wp-json/oembed/1.0/embed%3Furl=http:%252F%252Fwww.michelepasin.org%252Fblog%252F2010%252F11%252F17%252Fpreloading-stuff-in-djangos-interactive-shell%252F&amp;format=xml" />
<style data-context="foundation-flickity-css">/*! Flickity v2.0.2
http://flickity.metafizzy.co
---------------------------------------------- */.flickity-enabled{position:relative}.flickity-enabled:focus{outline:0}.flickity-viewport{overflow:hidden;position:relative;height:100%}.flickity-slider{position:absolute;width:100%;height:100%}.flickity-enabled.is-draggable{-webkit-tap-highlight-color:transparent;tap-highlight-color:transparent;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.flickity-enabled.is-draggable .flickity-viewport{cursor:move;cursor:-webkit-grab;cursor:grab}.flickity-enabled.is-draggable .flickity-viewport.is-pointer-down{cursor:-webkit-grabbing;cursor:grabbing}.flickity-prev-next-button{position:absolute;top:50%;width:44px;height:44px;border:none;border-radius:50%;background:#fff;background:hsla(0,0%,100%,.75);cursor:pointer;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.flickity-prev-next-button:hover{background:#fff}.flickity-prev-next-button:focus{outline:0;box-shadow:0 0 0 5px #09f}.flickity-prev-next-button:active{opacity:.6}.flickity-prev-next-button.previous{left:10px}.flickity-prev-next-button.next{right:10px}.flickity-rtl .flickity-prev-next-button.previous{left:auto;right:10px}.flickity-rtl .flickity-prev-next-button.next{right:auto;left:10px}.flickity-prev-next-button:disabled{opacity:.3;cursor:auto}.flickity-prev-next-button svg{position:absolute;left:20%;top:20%;width:60%;height:60%}.flickity-prev-next-button .arrow{fill:#333}.flickity-page-dots{position:absolute;width:100%;bottom:-25px;padding:0;margin:0;list-style:none;text-align:center;line-height:1}.flickity-rtl .flickity-page-dots{direction:rtl}.flickity-page-dots .dot{display:inline-block;width:10px;height:10px;margin:0 8px;background:#333;border-radius:50%;opacity:.25;cursor:pointer}.flickity-page-dots .dot.is-selected{opacity:1}</style><style data-context="foundation-slideout-css">.slideout-menu{position:fixed;left:0;top:0;bottom:0;right:auto;z-index:0;width:256px;overflow-y:auto;-webkit-overflow-scrolling:touch;display:none}.slideout-menu.pushit-right{left:auto;right:0}.slideout-panel{position:relative;z-index:1;will-change:transform}.slideout-open,.slideout-open .slideout-panel,.slideout-open body{overflow:hidden}.slideout-open .slideout-menu{display:block}.pushit{display:none}</style>
<link rel='dns-prefetch' href='http://v0.wordpress.com/'/>
<style type='text/css'>img#wpstats{display:none}</style>
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="Preloading stuff in django&#8217;s interactive shell" />
<meta property="og:url" content="http://www.michelepasin.org/blog/2010/11/17/preloading-stuff-in-djangos-interactive-shell/" />
<meta property="og:description" content="Django&#8217;s shell is a fantastic way to interact with all the components of your django application, eg when testing new functionalities or debugging a nasty error. Sometimes though you end up l…" />
<meta property="article:published_time" content="2010-11-17T18:41:07+00:00" />
<meta property="article:modified_time" content="2010-11-17T18:41:07+00:00" />
<meta property="og:site_name" content="Parerga und Paralipomena" />
<meta property="og:image" content="https://s0.wp.com/i/blank.jpg" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:text:title" content="Preloading stuff in django&#8217;s interactive shell" />
<meta name="twitter:card" content="summary" />

<!-- End Jetpack Open Graph Tags -->
<style>.ios7.web-app-mode.has-fixed header{ background-color: rgba(3,122,221,.88);}</style>			<style type="text/css" id="wp-custom-css">
				.entry ul li {
	list-style: disc;
}

.entry ol li {
	list-style: lower-roman;
}

			</style>
			</head>
	<body>
		<div class="page">
			<div id="header">
				<a href="../../../../index.html">Parerga und Paralipomena</a> / <span class="description">At the core of all well-founded belief lies belief that is unfounded &#8211; Wittgenstein</span><span style="float:right;"><a href="../../../../feed/index.html" title="">
						<img src="../../../../wp-content/themes/ub_modio/images/rss_black.png" alt="Parerga und Paralipomena Feed" width="14" height="14"/>
					</a>
				</span>
			</div><!-- end header --><div id="content" class="widecolumn">

		<div class="post" id="post-1012">
		<h2><a href="index.html" rel="bookmark" title="Permanent Link: Preloading stuff in django&#8217;s interactive shell">Preloading stuff in django&#8217;s interactive shell</a>
		</h2>
		<div class="entry">
				<p><a href="http://docs.djangoproject.com/en/dev/ref/django-admin/#shell">Django&#8217;s shell</a> is a fantastic way to interact with all the components of your django application, eg when testing new functionalities or debugging a nasty error. Sometimes though you end up loading the same variables or importing the same modules every time you run the shell , for example because you are trying out a large function that needs being refined through a trial and error process. </p>
<p>Opening up the shell and reloading all the components you need to have handy can thus become a bit tedious; here&#8217;s an easy way to go around this problem.<br />
In doing this, I&#8217;ve just been inspired some code found in the handy <a href="https://github.com/django-extensions/django-extensions">django-extensions</a> app. The extensions ship with a number of <a href="http://code.google.com/p/django-command-extensions/wiki/CommandExtensions">command modules</a>, that is, functions that you can run from the unix shell using the usual <em>python manage.py some_command</em> syntax.  </p>
<p>The module I&#8217;m talking about here is called <strong>shell_plus</strong> &#8211; it&#8217;s an enhanced version of the Django shell. It will autoload all your models making it easy to work with the ORM right away. Here&#8217;s the implementation:</p>
<pre style="font-size: 13px; line-height: 150%;"><div class="python" style="font-family:monospace;color: #006; border: 1px solid #d0d0d0; background-color: #f0f0f0; overflow:auto;"><span style="color: #808080; font-style: italic;"># django_extensions/management/commands/shell_plus.py</span><br />
<br />
<span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">os</span><br />
<span style="color: #ff7700;font-weight:bold;">from</span> django.<span style="color: black;">core</span>.<span style="color: black;">management</span>.<span style="color: black;">base</span> <span style="color: #ff7700;font-weight:bold;">import</span> NoArgsCommand<br />
<span style="color: #ff7700;font-weight:bold;">from</span> <span style="color: #dc143c;">optparse</span> <span style="color: #ff7700;font-weight:bold;">import</span> make_option<br />
<br />
<span style="color: #ff7700;font-weight:bold;">class</span> Command<span style="color: black;">&#40;</span>NoArgsCommand<span style="color: black;">&#41;</span>:<br />
&nbsp; &nbsp; option_list = NoArgsCommand.<span style="color: black;">option_list</span> + <span style="color: black;">&#40;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; make_option<span style="color: black;">&#40;</span><span style="color: #483d8b;">'--plain'</span>, action=<span style="color: #483d8b;">'store_true'</span>, dest=<span style="color: #483d8b;">'plain'</span>,<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #008000;">help</span>=<span style="color: #483d8b;">'Tells Django to use plain Python, not IPython.'</span><span style="color: black;">&#41;</span>,<br />
&nbsp; &nbsp; &nbsp; &nbsp; make_option<span style="color: black;">&#40;</span><span style="color: #483d8b;">'--no-pythonrc'</span>, action=<span style="color: #483d8b;">'store_true'</span>, dest=<span style="color: #483d8b;">'no_pythonrc'</span>,<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #008000;">help</span>=<span style="color: #483d8b;">'Tells Django to use plain Python, not IPython.'</span><span style="color: black;">&#41;</span>,<br />
&nbsp; &nbsp; <span style="color: black;">&#41;</span><br />
&nbsp; &nbsp; <span style="color: #008000;">help</span> = <span style="color: #483d8b;">&quot;Like the 'shell' command but autoloads the models of all installed Django apps.&quot;</span><br />
<br />
&nbsp; &nbsp; requires_model_validation = <span style="color: #008000;">True</span><br />
<br />
&nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">def</span> handle_noargs<span style="color: black;">&#40;</span><span style="color: #008000;">self</span>, <span style="color: #66cc66;">**</span>options<span style="color: black;">&#41;</span>:<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;"># XXX: (Temporary) workaround for ticket #1796: force early loading of all</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;"># models from installed apps. (this is fixed by now, but leaving it here</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;"># for people using 0.96 or older trunk (pre [5919]) versions.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">from</span> django.<span style="color: black;">db</span>.<span style="color: black;">models</span>.<span style="color: black;">loading</span> <span style="color: #ff7700;font-weight:bold;">import</span> get_models, get_apps<br />
&nbsp; &nbsp; &nbsp; &nbsp; loaded_models = get_models<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; use_plain = options.<span style="color: black;">get</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'plain'</span>, <span style="color: #008000;">False</span><span style="color: black;">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; use_pythonrc = <span style="color: #ff7700;font-weight:bold;">not</span> options.<span style="color: black;">get</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'no_pythonrc'</span>, <span style="color: #008000;">True</span><span style="color: black;">&#41;</span><br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;"># Set up a dictionary to serve as the environment for the shell, so</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;"># that tab completion works on objects that are imported at runtime.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;"># See ticket 5082.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">from</span> django.<span style="color: black;">conf</span> <span style="color: #ff7700;font-weight:bold;">import</span> settings<br />
&nbsp; &nbsp; &nbsp; &nbsp; imported_objects = <span style="color: black;">&#123;</span><span style="color: #483d8b;">'settings'</span>: settings<span style="color: black;">&#125;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">for</span> app_mod <span style="color: #ff7700;font-weight:bold;">in</span> get_apps<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span>:<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; app_models = get_models<span style="color: black;">&#40;</span>app_mod<span style="color: black;">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">if</span> <span style="color: #ff7700;font-weight:bold;">not</span> app_models:<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">continue</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; model_labels = <span style="color: #483d8b;">&quot;, &quot;</span>.<span style="color: black;">join</span><span style="color: black;">&#40;</span><span style="color: black;">&#91;</span>model.__name__ <span style="color: #ff7700;font-weight:bold;">for</span> model <span style="color: #ff7700;font-weight:bold;">in</span> app_models<span style="color: black;">&#93;</span><span style="color: black;">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #008000;">self</span>.<span style="color: black;">style</span>.<span style="color: black;">SQL_COLTYPE</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;From '%s' autoload: %s&quot;</span> <span style="color: #66cc66;">%</span> <span style="color: black;">&#40;</span>app_mod.__name__.<span style="color: black;">split</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'.'</span><span style="color: black;">&#41;</span><span style="color: black;">&#91;</span>-<span style="color: #ff4500;">2</span><span style="color: black;">&#93;</span>, model_labels<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">for</span> model <span style="color: #ff7700;font-weight:bold;">in</span> app_models:<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">try</span>:<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; imported_objects<span style="color: black;">&#91;</span>model.__name__<span style="color: black;">&#93;</span> = <span style="color: #008000;">getattr</span><span style="color: black;">&#40;</span><span style="color: #008000;">__import__</span><span style="color: black;">&#40;</span>app_mod.__name__, <span style="color: black;">&#123;</span><span style="color: black;">&#125;</span>, <span style="color: black;">&#123;</span><span style="color: black;">&#125;</span>, model.__name__<span style="color: black;">&#41;</span>, model.__name__<span style="color: black;">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">AttributeError</span>, e:<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">print</span> <span style="color: #008000;">self</span>.<span style="color: black;">style</span>.<span style="color: black;">ERROR_OUTPUT</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;Failed to import '%s' from '%s' reason: %s&quot;</span> <span style="color: #66cc66;">%</span> <span style="color: black;">&#40;</span>model.__name__, app_mod.__name__.<span style="color: black;">split</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">'.'</span><span style="color: black;">&#41;</span><span style="color: black;">&#91;</span>-<span style="color: #ff4500;">2</span><span style="color: black;">&#93;</span>, <span style="color: #008000;">str</span><span style="color: black;">&#40;</span>e<span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><span style="color: black;">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">continue</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">try</span>:<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">if</span> use_plain:<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;"># Don't bother loading IPython, because the user wants plain Python.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">raise</span> <span style="color: #008000;">ImportError</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">import</span> IPython<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;"># Explicitly pass an empty list as arguments, because otherwise IPython</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;"># would use sys.argv from this script.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; shell = IPython.<span style="color: black;">Shell</span>.<span style="color: black;">IPShell</span><span style="color: black;">&#40;</span>argv=<span style="color: black;">&#91;</span><span style="color: black;">&#93;</span>, user_ns=imported_objects<span style="color: black;">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; shell.<span style="color: black;">mainloop</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">ImportError</span>:<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;"># Using normal Python shell</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">code</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">try</span>: <span style="color: #808080; font-style: italic;"># Try activating rlcompleter, because it's handy.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">readline</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">ImportError</span>:<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">pass</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">else</span>:<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;"># We don't have to wrap the following import in a 'try', because</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;"># we already know 'readline' was imported successfully.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">rlcompleter</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #dc143c;">readline</span>.<span style="color: black;">set_completer</span><span style="color: black;">&#40;</span><span style="color: #dc143c;">rlcompleter</span>.<span style="color: black;">Completer</span><span style="color: black;">&#40;</span>imported_objects<span style="color: black;">&#41;</span>.<span style="color: black;">complete</span><span style="color: black;">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #dc143c;">readline</span>.<span style="color: black;">parse_and_bind</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;tab:complete&quot;</span><span style="color: black;">&#41;</span><br />
<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;"># We want to honor both $PYTHONSTARTUP and .pythonrc.py, so follow system</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;"># conventions and get $PYTHONSTARTUP first then import user.</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">if</span> use_pythonrc:<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pythonrc = <span style="color: #dc143c;">os</span>.<span style="color: black;">environ</span>.<span style="color: black;">get</span><span style="color: black;">&#40;</span><span style="color: #483d8b;">&quot;PYTHONSTARTUP&quot;</span><span style="color: black;">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">if</span> pythonrc <span style="color: #ff7700;font-weight:bold;">and</span> <span style="color: #dc143c;">os</span>.<span style="color: black;">path</span>.<span style="color: black;">isfile</span><span style="color: black;">&#40;</span>pythonrc<span style="color: black;">&#41;</span>:<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">try</span>:<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #008000;">execfile</span><span style="color: black;">&#40;</span>pythonrc<span style="color: black;">&#41;</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">except</span> <span style="color: #008000;">NameError</span>:<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">pass</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #808080; font-style: italic;"># This will import .pythonrc.py as a side-effect</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #ff7700;font-weight:bold;">import</span> <span style="color: #dc143c;">user</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #dc143c;">code</span>.<span style="color: black;">interact</span><span style="color: black;">&#40;</span>local=imported_objects<span style="color: black;">&#41;</span></div></pre>
<p>Essentially, this is what&#8217;s going on here:</p>
<p>a. A <strong>subclass of NoArgsCommand is created</strong> following the standard approach stated in Django&#8217;s <a href="http://docs.djangoproject.com/en/dev/howto/custom-management-commands/">docs for creating custom management commands</a> . </p>
<p>b. All the <strong>applications</strong> in your django project and the related <strong>models</strong> get <strong>loaded</strong>, and their references are added to the <strong>imported_objects</strong> dictionary, eg when the code reads:</p>
<pre><code style="font-size:14px;color:#000000; background:lavender; overflow:auto;">
imported_objects = {'settings': settings}</code></pre>
<p>c. The code tries to <strong>load the best python shell</strong> available: iPython if present, otherwise the normal python shell with the necessary libraries are called.</p>
<p>&#8230;</p>
<p>That&#8217;s all. The key line to look at is therefore the last one, that is:</p>
<pre><code style="font-size:14px;color:#000000; background:lavender; overflow:auto;">
# .......
code.interact(local=imported_objects)</code></pre>
<p>That&#8217;s what launches the interpreter and initializes it with the <em><strong>imported_objects</strong></em> dictionary; this dictionary contains all the (extra) symbols that we want to make available through the new python interpreter instance. So in order to have more stuff there all we have to do is add more elements to that dictionary, eg:</p>
<pre><code style="font-size:14px;color:#000000; background:lavender; overflow:auto;">
# .......
alist = range(1000)
imported_objects['alist'] = alist
code.interact(local=imported_objects)</code></pre>
<p>Insert these two lines right before the last line of the script above, save it using a new name (eg. <em>my_fancyshell.py</em> )in the <em>/management/commands/</em> directory of one of your applications (it needs to be there so that django interprets it as a custom command), and the game is done. Now you can invoke </p>
<pre><code style="font-size:14px;color:#000000; background:lavender; overflow:auto;">
bash-3.2$ python manage.py my_fancyshell.py</code></pre>
<p>from the unix command line, and the &#8216;alist&#8217; symbol will be available.<br />
Obviously in a real world situation you might end up loading and adding to the <em>imported_objects</em> dictionary various many things too, but the principle will remain the same!</p>
<p>&#8230;</p>
				
			<!-- <script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script> -->
			<!-- AddToAny BEGIN -->
			<a class="a2a_dd" href="http://www.addtoany.com/share_save"><img src="http://static.addtoany.com/buttons/share_save_256_24.png" width="256" height="24" border="0" alt="Share/Bookmark"/></a>
			<script type="text/javascript" src="http://static.addtoany.com/menu/page.js"></script>
			<!-- AddToAny END -->
			
			
						</div><!-- end entry --><br/><br/>
	</div><!-- end post -->
	<ul class="post">
		<li><b>META</b> / ABOUT THIS POST</li>
		<li>This entry was posted
									on Wednesday, November 17th, 2010 at 6:41 pm			and is filed under <a href="../../../../category/techlife/index.html" rel="category tag">TechLife</a>, <a href="../../../../category/tips-and-tricks/index.html" rel="category tag">Tips and Tricks</a>. Tags: <a href="../../../../tag/django/index.html" rel="tag">django</a>, <a href="../../../../tag/shell/index.html" rel="tag">shell</a>.
			You can follow any responses to this entry through the <a href="feed/index.html">RSS 2.0</a> feed.

									Both comments and pings are currently closed.

								</li>
	</ul><br/><br/>
	<ul class="post">
		<li><b>PAGES</b> / FORWARD OR BACK?</li>
		<li>Previous: <a href="../../09/ryoji-ikeda/index.html" rel="prev">Ryoji Ikeda</a></li>
		<li>Next: <a href="../../25/clojure-or-not-clojure/index.html" rel="next">Clojure or not clojure?</a></li>
	</ul><br/><br/>
					
							
			
	
<!-- You can start editing here. -->

<h3 class="comments"><span class="dsq-postid" data-dsqidentifier="1012 http://www.michelepasin.org/blog/?p=1012">3 Responses</span> to &#8220;Preloading stuff in django&#8217;s interactive shell&#8221;
</h3>

	<div class="alt bubble" id="comment-174">
	<blockquote><p>[&#8230;] link Share this:TwitterFacebookLike this:LikeBe the first to like this post.      &laquo; Previous post [&#8230;]</p>
</blockquote>
	<cite><a href='http://pythoncoding.wordpress.com/2012/03/06/preloading-stuff-in-djangos-interactive-shell/' rel='external nofollow' class='url'>Preloading stuff in django’s interactive shell &laquo; Programming</a> added these pithy words on <a href="index.html#comment-174" title="">Mar 06 12 at 9:20 pm</a> 	</cite> 
			</div>

	
	<div class=" bubble" id="comment-175">
	<blockquote><p>[&#8230;] <a href="index.html" rel="nofollow">http://www.michelepasin.org/blog/2010/11/17/preloading-stuff-in-djangos-interactive-shell/</a> [&#8230;]</p>
</blockquote>
	<cite><a href='http://labs.karpanen.fi/2012/07/unohtunut-salasana-djangossa/' rel='external nofollow' class='url'>MediaKärpänen - LABS: Luonnikkaan Aerodynaaminen Beatnikki Sijaisnäyttelijä &raquo; Unohtunut salasana Djangossa&#8230;</a> added these pithy words on <a href="index.html#comment-175" title="">Jul 07 12 at 11:38 pm</a> 	</cite> 
			</div>

	
	<div class="alt bubble" id="comment-6574">
	<blockquote><p>Brilliant!</p>
</blockquote>
	<cite>Heliodor added these pithy words on <a href="index.html#comment-6574" title="">Apr 06 13 at 12:01 am</a> 	</cite> 
			</div>

	
	

 


	</div><!-- end content -->	
<div id="sidebar">


	<p class="menu"><B>INSIDE&nbsp;&nbsp;&nbsp;&nbsp;&larr;</b></p><br/>
		<p><a href="../../../../index.html">Parerga und Paralipomena</a></p>
		<li id="pages-2" class="widget widget_pages"><h2 class="widgettitle">Pages</h2>
		<ul>
			<li class="page_item page-item-532"><a href="../../../../about-2/index.html">About Me</a></li>
<li class="page_item page-item-3355"><a href="../../../../latest-from-twitter/index.html">Latest from Twitter</a></li>
		</ul>
			</li>
<li id="categories-2" class="widget widget_categories"><h2 class="widgettitle">Categories</h2>
		<ul>
				<li class="cat-item cat-item-408"><a href="../../../../category/computermusic/index.html">Computer Music</a>
</li>
	<li class="cat-item cat-item-3"><a href="../../../../category/culturalinformatics/index.html">Cultural Informatics</a>
</li>
	<li class="cat-item cat-item-455"><a href="../../../../category/data-science/index.html">Data science</a>
</li>
	<li class="cat-item cat-item-4"><a href="../../../../category/informationarchitecture/index.html">Information Architecture</a>
</li>
	<li class="cat-item cat-item-5"><a href="../../../../category/justblogging/index.html">Just Blogging</a>
</li>
	<li class="cat-item cat-item-6"><a href="../../../../category/semantic-web/index.html">Semantic Web</a>
</li>
	<li class="cat-item cat-item-7"><a href="../../../../category/techlife/index.html">TechLife</a>
</li>
	<li class="cat-item cat-item-8"><a href="../../../../category/tips-and-tricks/index.html">Tips and Tricks</a>
</li>
		</ul>
			</li>
 
		
		<!-- mikele: the stuff above doesn't get activated so I put it here -->
<br/><br/>
		<ul style="text-align:right;">

			<p><b>FIND</b> / SEARCH</p>
			<form method="get" id="search_form" action="../../../../index.html">
				<input type="text" class="search_input" value="Type and hit enter..." name="s" id="s" onfocus="if (this.value == 'Type and hit enter...') {this.value = '';}" onblur="if (this.value == '') {this.value = 'Type and hit enter...';}" />
				<input type="hidden" id="searchsubmit" value="Search" />
			</form>
		</ul><br/>


<!-- 	
		<!-- mikele: adsense 
		<br/>
                 <ul style="text-align:right;">
		<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

		<ins class="adsbygoogle"
		     style="display:block"
		     data-ad-client="ca-pub-8108687655438913"
		     data-ad-slot="2230044782"
		     data-ad-format="auto"></ins>
		<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
		</script>
                </ul><br/> 
-->

		
		
		
	</div><!-- end sidebar --><div class="footer">
	<p><b>FOOTER</b> / LEST WE FORGET<br/>
<!-- If you'd like to support WordPress, having the "powered by" link someone on your blog is the best way, it's our only promotion or advertising. -->

<!-- Change this theme as you wish, but PLEASE keep a visible link to http://www.upstartblogger.com/ somewhere on every page of your blog (for example, in the sidebar or footer). You aren't going to delete the WordPress link, are you? Please don't delete mine. Thanks! -->
		Copyright &copy; 2004-2007 by Parerga und Paralipomena, unless otherwise noted. All rights reserved. Powered by <a href="http://wordpress.org/" title="WordPress">WordPress</a>. Original Modio theme by <a href="http://www.upstartblogger.com/" title="Upstart Blogger">Upstart Blogger</a>, modified by Michele Pasin.






</p>
	<!-- 43 queries. 0.335 seconds. -->





</div><!-- end footer -->

<!-- Start of Flickr Badge -->
<style type="text/css">
#flickr_badge_source_txt {padding:0; font: 11px Arial, Helvetica, Sans serif; color:#666666;}
#flickr_badge_icon {display:block !important; margin:0 !important; border: 1px solid rgb(0, 0, 0) !important;}
#flickr_icon_td {padding:0 5px 0 0 !important;}
.flickr_badge_image {text-align:center !important;}
.flickr_badge_image img {border: 1px solid black !important;}
#flickr_www {display:block; padding:0 10px 0 10px !important; font: 11px Arial, Helvetica, Sans serif !important; color:#3993ff !important;}
#flickr_badge_uber_wrapper table {margin-left:265px; margin-top:50px; position:absolute;}
#flickr_badge_uber_wrapper a:hover,
#flickr_badge_uber_wrapper a:link,
#flickr_badge_uber_wrapper a:active,
#flickr_badge_uber_wrapper a:visited {text-decoration:none !important; background:inherit !important;color:#3993ff;}
#flickr_badge_wrapper {background-color:#ffffff;border: solid 1px #000000}
#flickr_badge_source {padding:0 !important; font: 11px Arial, Helvetica, Sans serif !important; color:#666666 !important;}
</style>
<table id="flickr_badge_uber_wrapper" cellpadding="0" cellspacing="10" border="0"><tr><td><table cellpadding="0" cellspacing="10" border="0" id="flickr_badge_wrapper">
<tr>
<script type="text/javascript" src="http://www.flickr.com/badge_code_v2.gne?count=5&display=random&size=s&layout=h&source=user&user=76186999%40N00"></script>
</tr>
</table>
</td></tr></table>
<!-- End of Flickr Badge -->


</div><!-- end page -->
<!-- Powered by WPtouch: 4.3.39 -->	<div style="display:none">
	</div>
<script type='text/javascript' src='https://secure.gravatar.com/js/gprofiles.js?ver=2021Augaa'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='../../../../wp-content/plugins/jetpack/modules/wpgroho.js%3Fver=5.2.11'></script>
<script type='text/javascript' src='../../../../wp-includes/js/wp-embed.min.js%3Fver=5.2.11'></script>
<script type='text/javascript' src='https://stats.wp.com/e-202134.js' async='async' defer='defer'></script>
<script type='text/javascript'>
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:8.1.2',blog:'13825966',post:'1012',tz:'0',srv:'www.michelepasin.org'} ]);
	_stq.push([ 'clickTrackerInit', '13825966', '1012' ]);
</script>
</body>
</html>