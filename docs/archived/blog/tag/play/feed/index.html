<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	
	xmlns:georss="http://www.georss.org/georss"
	xmlns:geo="http://www.w3.org/2003/01/geo/wgs84_pos#"
	>

<channel>
	<title>play &#8211; Parerga und Paralipomena</title>
	<atom:link href="http://www.michelepasin.org/blog/tag/play/feed/" rel="self" type="application/rss+xml" />
	<link>http://www.michelepasin.org/blog</link>
	<description>At the core of all well-founded belief lies belief that is unfounded - Wittgenstein</description>
	<lastBuildDate>Tue, 29 Mar 2011 20:17:12 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>
	hourly	</sy:updatePeriod>
	<sy:updateFrequency>
	1	</sy:updateFrequency>
	<generator>https://wordpress.org/?v=5.2.11</generator>
<site xmlns="com-wordpress:feed-additions:1">13825966</site>	<item>
		<title>An alternative to the &#8216;play&#8217; macro: &#8216;iplay&#8217; and &#8216;with-instrument&#8217;</title>
		<link>http://www.michelepasin.org/blog/2011/03/29/an-alternative-to-the-play-macro-iplay-and-with-instrument/</link>
				<pubDate>Tue, 29 Mar 2011 20:17:12 +0000</pubDate>
		<dc:creator><![CDATA[mikele]]></dc:creator>
				<category><![CDATA[Computer Music]]></category>
		<category><![CDATA[impromptu]]></category>
		<category><![CDATA[macro]]></category>
		<category><![CDATA[play]]></category>

		<guid isPermaLink="false">http://www.michelepasin.org/blog/?p=1008</guid>
				<description><![CDATA[The other day I was thinking: when I use the play macro in Impromptu [video tutorial], in my head it&#8217;s already obvious what&#8217;s the virtual instrument I want to play. So why do I have to specify that all the time? Wouldn&#8217;t it be more natural just being able to say, for example, get this [&#8230;]]]></description>
								<content:encoded><![CDATA[<p>The other day I was thinking: when I use the <a href="http://moso.com.au/wiki/index.php?title=Play">play macro in Impromptu</a> [<a href="http://impromptu.moso.com.au/resources.html#faq16">video tutorial</a>], in my head it&#8217;s already <strong>obvious</strong> what&#8217;s the virtual instrument I want to play. So why do I have to specify that all the time? Wouldn&#8217;t it be more natural just being able to say, for example, <strong>get this instrument</strong> and now <strong>play this and that note with it</strong>&#8230; </p>
<p>Let me clarify this with an example. Let&#8217;s set up the standard Apple&#8217;s DLS-synth audiounit and the metronome:</p>
<pre style='color:#000000;background:#ffffff;'><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>au:clear-graph</span><span style='color:#808030; '>)</span>
<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>define</span> dls     <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>au:make-node</span> <span style='color:#0000e6; '>"aumu"</span> <span style='color:#0000e6; '>"dls "</span> <span style='color:#0000e6; '>"appl"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>au:connect-node</span> dls <span style='color:#008c00; '>0</span> *au:<span style='color:#400000; '>output-node*</span> <span style='color:#008c00; '>0</span><span style='color:#808030; '>)</span>
<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>au:update-graph</span><span style='color:#808030; '>)</span>
<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>au:print-graph</span><span style='color:#808030; '>)</span>
<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>define</span> *metro* <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>make-metro</span> <span style='color:#008c00; '>100</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
</pre>
<p>Now imagine that we want to play some (dumb) melody with Apple&#8217;s DLS. We can use the usual <em>play</em> macro to achieve this quite easily (that&#8217;s because above we set up the metronome, which is needed in order to use <em>play</em> &#8211; check out the <a href="http://moso.com.au/wiki/index.php?title=Play">docs</a> if this sounds odd to you). </p>
<p>Sequencing a bunch of notes is thus just a matter of sequencing <em>play</em> macros:  </p>
<pre style='color:#000000;background:#ffffff;'><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>define</span> the-usual-play
   <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>lambda</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>beat</span><span style='color:#808030; '>)</span> 
      <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>play</span> dls <span style='color:#008c00; '>60</span> <span style='color:#008c00; '>90</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span>
      <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>play</span> dls <span style='color:#008c00; '>64</span> <span style='color:#008c00; '>90</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span>
      <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>play</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>/</span><span style='color:#008c00; '>2</span> dls <span style='color:#008c00; '>72</span> <span style='color:#008c00; '>90</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span>
      <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>play</span> <span style='color:#008c00; '>3</span><span style='color:#808030; '>/</span><span style='color:#008c00; '>2</span> dls <span style='color:#008c00; '>67</span> <span style='color:#008c00; '>90</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span>
      <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>callback</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>*metro*</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>+</span> beat <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>*</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>/</span><span style='color:#008c00; '>2</span> <span style='color:#008c00; '>2</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>'the-usual-play</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>+</span> beat <span style='color:#008c00; '>2</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>

<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>the-usual-play</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>*metro*</span> <span style='color:#800080; '>'get-beat</span> <span style='color:#008c00; '>4</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
</pre>
<p><strong>That&#8217;s where I started getting nervous</strong> (so to say). Having to write &#8216;dls&#8217; each time I play a new note seemed to me redundant and illogical; I <strong>know</strong> that it&#8217;s dls the instrument I want to play &#8211; I heard my mind screaming &#8211; why can&#8217;t I focus on the music instead of making sure I type in the instrument name all the time?</p>
<h3>Taking advantage of Scheme, the self-modifying language</h3>
<p>Luckily though we&#8217;re using <a href="http://www.michelepasin.org/blog/2010/08/10/learning-resources-about-scheme/">Scheme</a>, which differently from most other computer languages allows you to change the language grammar as you like, thanks to <a href="http://en.wikipedia.org/wiki/Macro_(computer_science)">macros</a>. So here we go, we can create a new macro similar to <em>play</em> that lets you omit the instrument you&#8217;re playing. We&#8217;ll call it <em><strong>iplay</strong></em> (shortcut for instrument-play, not itunes :-)):</p>
<pre style='color:#000000;background:#ffffff;'><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>macro</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>iplay</span> args<span style='color:#808030; '>)</span>  
   <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>cond</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>equal?</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>length</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>cdr</span> args<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#008c00; '>3</span><span style='color:#808030; '>)</span>
          `<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>let</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>note</span> <span style='color:#666616; '>,</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>cadr</span> args<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
                 <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>vol</span> <span style='color:#666616; '>,</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>caddr</span> args<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
                 <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>dur</span> <span style='color:#666616; '>,</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>cadddr</span> args<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
                 <span style='color:#808030; '>)</span>
              <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>play</span> my-inst note vol dur<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
         <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>equal?</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>length</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>cdr</span> args<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#008c00; '>4</span><span style='color:#808030; '>)</span>
          `<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>let</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>offset</span> <span style='color:#666616; '>,</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>cadr</span> args<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
                 <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>note</span> <span style='color:#666616; '>,</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>caddr</span> args<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
                 <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>vol</span> <span style='color:#666616; '>,</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>cadddr</span> args<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
                 <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>dur</span> <span style='color:#666616; '>,</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>cadddr</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>cdr</span> args<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>               
           <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>play</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>eval</span> offset<span style='color:#808030; '>)</span> my-inst note vol dur<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
         <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>#t</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>print</span> <span style='color:#0000e6; '>"Error: the function only accepts 3 or 4 argument"</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
</pre>
<p>Essentially what we&#8217;re telling the interpreter here is that every time <em>iplay</em> is used, the original <em>play</em> should be called and the symbol <em>my-inst</em> should be passed as the variable representing our instrument. Now we can modify the simple loop defined above like this: </p>
<pre style='color:#000000;background:#ffffff;'><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>define</span> the-usual-play-modified
   <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>lambda</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>beat</span><span style='color:#808030; '>)</span> 
      <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>let</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>my-inst</span> dls<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
         <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>iplay</span> <span style='color:#008c00; '>60</span> <span style='color:#008c00; '>90</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span>
         <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>iplay</span> <span style='color:#008c00; '>64</span> <span style='color:#008c00; '>90</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
      <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>play</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>/</span><span style='color:#008c00; '>2</span> dls <span style='color:#008c00; '>72</span> <span style='color:#008c00; '>90</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span>
      <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>play</span> <span style='color:#008c00; '>3</span><span style='color:#808030; '>/</span><span style='color:#008c00; '>2</span> dls <span style='color:#008c00; '>67</span> <span style='color:#008c00; '>90</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span>
      <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>callback</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>*metro*</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>+</span> beat <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>*</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>/</span><span style='color:#008c00; '>2</span> <span style='color:#008c00; '>2</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>'the-usual-play-modified</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>+</span> beat <span style='color:#008c00; '>2</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>

<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>the-usual-play-modified</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>*metro*</span> <span style='color:#800080; '>'get-beat</span> <span style='color:#008c00; '>4</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
</pre>
<p>If you run that, you&#8217;ll see that this loop sounds exactly the same as the previous one, although the first two <em>play</em> calls are now <em><strong>iplay</strong></em> macro calls. The whole thing works because we introduced a local variable <em>my-inst</em> and bound that to the dls audio instrument (created at the beginning). Notice that <strong>the new macro <em>iplay</em> knows nothing about what instrument is playing</strong>: it&#8217;s just using blindly the <em>my-inst</em> variable, under the assumption that we&#8217;ve associated it to a valid audio instrument. </p>
<h3>Some more syntactic sugar</h3>
<p>The only hassle now is that each time we want to use <em>iplay</em> we are forced to use the <em>(let ((my-inst dls))..</em> form. Typing this stuff doesn&#8217;t feel very natural too. Rather, in my head, I tend to see things like this: get an instrument first, then play a bunch of notes with it. </p>
<p>So, let&#8217;s create some syntactic sugar for the &#8216;<em>let</em>&#8216; form, by defining another macro, &#8216;<em>with-instrument</em>&#8216;:</p>
<pre style='color:#000000;background:#ffffff;'><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>macro</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>with-instrument</span> args<span style='color:#808030; '>)</span>
   `<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>let</span> <span style='color:#808030; '>(</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>my-inst</span> <span style='color:#666616; '>,</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>cadr</span> args<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
       <span style='color:#666616; '>,@</span><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>cddr</span> args<span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
</pre>
<p>As you can see, this macro doesn&#8217;t do much: it just rephrases the <em>let</em> form above in a way that is probably more natural to me (and to others too I believe..). </p>
<p>For example, now we can use <em>iplay</em> like this: </p>
<pre style='color:#000000;background:#ffffff;'><span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>define</span> justatest
   <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>lambda</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>beat</span><span style='color:#808030; '>)</span>      
      <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>with-instrument</span> dls 
          <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>iplay</span> <span style='color:#008c00; '>48</span> <span style='color:#008c00; '>40</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span>  <span style='color:#696969; '>;; iplay with 3 args: pitch, vol and dur</span>
          <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>iplay</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>random</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>list</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>/</span><span style='color:#008c00; '>2</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>/</span><span style='color:#008c00; '>4</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>/</span><span style='color:#008c00; '>8</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>random</span> <span style='color:#008c00; '>60</span> <span style='color:#008c00; '>80</span><span style='color:#808030; '>)</span> <span style='color:#008c00; '>40</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>  <span style='color:#696969; '>;; 4 arguments: offset</span>
      <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>callback</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>*metro*</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>+</span> beat <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>*</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>/</span><span style='color:#008c00; '>2</span> <span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>'justatest</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>+</span> beat <span style='color:#008c00; '>1</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>

<span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>justatest</span> <span style='color:#808030; '>(</span><span style='color:#800000; font-weight:bold; '>*metro*</span> <span style='color:#800080; '>'get-beat</span> <span style='color:#008c00; '>4</span><span style='color:#808030; '>)</span><span style='color:#808030; '>)</span>
</pre>
<p>Finally, <strong>let&#8217;s remember</strong> that because of the way we defined <em>iplay</em> above, we can pass it 3 or 4 arguments: in the first case, the macro assumes that we&#8217;re providing a <strong>pitch</strong>, a <strong>volume</strong>, and a <strong>duration</strong>. In the second case instead the first argument is assumed to be an <strong>offset</strong> value (while the others remain unchanged). </p>
<p>The <a href="http://moso.com.au/wiki/index.php?title=Play">original <em>play</em> macro</a> can take another argument too: the <strong>channel</strong> (or midi port). I haven&#8217;t included here cause I normally don&#8217;t need it, but if you do I&#8217;m sure you can fiddle a bit with the code above and make it do whatever you want!</p>
<p>Conclusion: here is the code you need to evaluate within Impromptu if you want to use the with/iplay constructs (all the source code is also available on <a href="https://bitbucket.org/magicrebirth/impromptu_public/src/tip/_libs/playau.scm">BitBucket</a>):</p>
<pre style='color:#000000;background:#f1f0f0;'><span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>macro</span> <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>with-instrument</span> args<span style='color:#806030; '>)</span>
   `<span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>let</span> <span style='color:#806030; '>(</span><span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>my-inst</span> <span style='color:#00dddd; '>,</span><span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>cadr</span> args<span style='color:#806030; '>)</span><span style='color:#806030; '>)</span><span style='color:#806030; '>)</span>
       <span style='color:#00dddd; '>,@</span><span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>cddr</span> args<span style='color:#806030; '>)</span><span style='color:#806030; '>)</span><span style='color:#806030; '>)</span>


<span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>macro</span> <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>iplay</span> args<span style='color:#806030; '>)</span>
   <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>cond</span> <span style='color:#806030; '>(</span><span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>equal?</span> <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>length</span> <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>cdr</span> args<span style='color:#806030; '>)</span><span style='color:#806030; '>)</span> <span style='color:#c00000; '>3</span><span style='color:#806030; '>)</span>
          `<span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>let</span> <span style='color:#806030; '>(</span><span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>note</span> <span style='color:#00dddd; '>,</span><span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>cadr</span> args<span style='color:#806030; '>)</span><span style='color:#806030; '>)</span>
                 <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>vol</span> <span style='color:#00dddd; '>,</span><span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>caddr</span> args<span style='color:#806030; '>)</span><span style='color:#806030; '>)</span>
                 <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>dur</span> <span style='color:#00dddd; '>,</span><span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>cadddr</span> args<span style='color:#806030; '>)</span><span style='color:#806030; '>)</span>
                 <span style='color:#806030; '>)</span>
              <span style='color:#c34e00; '>;(print inst beat note vol dur)</span>
              <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>play</span> my-inst note vol dur<span style='color:#806030; '>)</span><span style='color:#806030; '>)</span><span style='color:#806030; '>)</span>
         <span style='color:#806030; '>(</span><span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>equal?</span> <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>length</span> <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>cdr</span> args<span style='color:#806030; '>)</span><span style='color:#806030; '>)</span> <span style='color:#c00000; '>4</span><span style='color:#806030; '>)</span>
          `<span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>let</span> <span style='color:#806030; '>(</span><span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>offset</span> <span style='color:#00dddd; '>,</span><span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>cadr</span> args<span style='color:#806030; '>)</span><span style='color:#806030; '>)</span>
                 <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>note</span> <span style='color:#00dddd; '>,</span><span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>caddr</span> args<span style='color:#806030; '>)</span><span style='color:#806030; '>)</span>
                 <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>vol</span> <span style='color:#00dddd; '>,</span><span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>cadddr</span> args<span style='color:#806030; '>)</span><span style='color:#806030; '>)</span>
                 <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>dur</span> <span style='color:#00dddd; '>,</span><span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>cadddr</span> <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>cdr</span> args<span style='color:#806030; '>)</span><span style='color:#806030; '>)</span><span style='color:#806030; '>)</span><span style='color:#806030; '>)</span>
           <span style='color:#c34e00; '>;(print inst beat note vol dur)</span>
           <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>play</span> <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>eval</span> offset<span style='color:#806030; '>)</span> my-inst note vol dur<span style='color:#806030; '>)</span><span style='color:#806030; '>)</span><span style='color:#806030; '>)</span>
         <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>#t</span> <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>print</span> <span style='color:#e60000; '>"Error: the function only accepts 3 or 4 argument"</span><span style='color:#806030; '>)</span><span style='color:#806030; '>)</span><span style='color:#806030; '>)</span><span style='color:#806030; '>)</span>
</pre>
<h3>Finally.. a &#8216;pastebin&#8217; function</h3>
<p>Also, here is a pastebin function similar to <a href="http://moso.com.au/wiki/index.php?title=Pb:cb">pb:cb</a> (check out this <a href="http://impromptu.moso.com.au/resources.html#faq15">video tutorial</a> if you don&#8217;t know what I&#8217;m talking about) that returns a template with the <em>with-instrument</em> macro:</p>
<pre style='color:#000000;background:#f1f0f0; overflow:auto;'><span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>define</span> pb<span style='color:#800000; font-weight:bold; '>:iplay</span> <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>lambda</span> <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>name</span> dur inst<span style='color:#806030; '>)</span> <span style='color:#806030; '>'</span><span style='color:#806030; '>(</span><span style='color:#806030; '>)</span><span style='color:#806030; '>)</span><span style='color:#806030; '>)</span>  <span style='color:#c34e00; '>;; fake function definition, useful for autocompletion!</span>

<span style='color:#c34e00; '>;; macro wrapper for pb-iplay</span>
<span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>define-macro</span> <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>pb:iplay</span> name dur inst <span style='color:#806030; '>.</span> args<span style='color:#806030; '>)</span>
   `<span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>pb-iplay</span> <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>sexpr->string</span> <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>quote</span> <span style='color:#00dddd; '>,name</span><span style='color:#806030; '>)</span><span style='color:#806030; '>)</span> 
              <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>sexpr->string</span> <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>quote</span> <span style='color:#00dddd; '>,dur</span><span style='color:#806030; '>)</span><span style='color:#806030; '>)</span>
              <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>sexpr->string</span> <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>quote</span> <span style='color:#00dddd; '>,inst</span><span style='color:#806030; '>)</span><span style='color:#806030; '>)</span>
              <span style='color:#00dddd; '>,@</span><span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>map</span> <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>lambda</span> <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>expr</span><span style='color:#806030; '>)</span>
                        <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>sexpr->string</span> expr<span style='color:#806030; '>)</span><span style='color:#806030; '>)</span>
                     args<span style='color:#806030; '>)</span><span style='color:#806030; '>)</span><span style='color:#806030; '>)</span>


<span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>define</span> pb-iplay
   <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>lambda</span> <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>name</span> dur inst <span style='color:#806030; '>.</span> args<span style='color:#806030; '>)</span>
      <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>let</span> <span style='color:#806030; '>(</span><span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>a</span> <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>apply</span> string-append <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>map</span> <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>lambda</span> <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>e</span><span style='color:#806030; '>)</span> <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>string-append</span> <span style='color:#e60000; '>"n      "</span> e<span style='color:#806030; '>)</span><span style='color:#806030; '>)</span> args<span style='color:#806030; '>)</span><span style='color:#806030; '>)</span><span style='color:#806030; '>)</span><span style='color:#806030; '>)</span>
         <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>sys:set-pasteboard</span>
         <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>string-append</span> 
<span style='color:#e60000; '>"(define "</span> name "
   <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>lambda</span> <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>beat</span><span style='color:#806030; '>)</span> 
      <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>with-instrument</span> <span style='color:#e60000; '>" inst "</span>
          <span style='color:#e60000; '>" a "</span>
     <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>callback</span> <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>*metro*</span> <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>+</span> beat <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>*</span> <span style='color:#c00000; '>1</span><span style='color:#806030; '>/</span><span style='color:#c00000; '>2</span> <span style='color:#e60000; '>" dur "</span><span style='color:#806030; '>)</span><span style='color:#806030; '>)</span><span style='color:#806030; '>)</span> <span style='color:#806030; '>'</span><span style='color:#e60000; '>" name "</span> <span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>+</span> beat <span style='color:#e60000; '>" dur "</span><span style='color:#806030; '>)</span><span style='color:#806030; '>)</span><span style='color:#806030; '>)</span><span style='color:#806030; '>)</span><span style='color:#806030; '>)</span>nn<span style='color:#806030; '>(</span><span style='color:#400000; font-weight:bold; '>"</span> name <span style='color:#e60000; '>" (*metro* 'get-beat 4))"</span><span style='color:#806030; '>)</span><span style='color:#806030; '>)</span><span style='color:#806030; '>)</span><span style='color:#806030; '>)</span><span style='color:#806030; '>)</span>



<span style='color:#c34e00; '>;;;;;;;;;;;;;;;;</span>
<span style='color:#c34e00; '>;; call it like this: </span>
<span style='color:#c34e00; '>;(pb:iplay myloop 1/4 dls)</span>
<span style='color:#c34e00; '>;;</span>

<span style='color:#c34e00; '>;;;;;;;;;;;;;;;;;</span>
<span style='color:#c34e00; '>;; returns: </span>
<span style='color:#c34e00; '>;;;;;;;;;;;;;;;;</span>

<span style='color:#c34e00; '>;</span>
<span style='color:#c34e00; '>;(define myloop</span>
<span style='color:#c34e00; '>;   (lambda (beat) </span>
<span style='color:#c34e00; '>;      (with-instrument dls</span>
<span style='color:#c34e00; '>;</span>
<span style='color:#c34e00; '>;     (callback (*metro* (+ beat (* 1/2 1/4))) 'myloop (+ beat 1/4)))))</span>
<span style='color:#c34e00; '>;</span>
<span style='color:#c34e00; '>;(myloop (*metro* 'get-beat 4))</span>
</pre>
]]></content:encoded>
									<post-id xmlns="com-wordpress:feed-additions:1">1008</post-id>	</item>
	</channel>
</rss>
