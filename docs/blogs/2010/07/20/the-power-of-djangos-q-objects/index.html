




<!DOCTYPE html>
<html lang="en">
  <head>



    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.3/d3.min.js"></script>


    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../../../../media/static/favicon.ico">

	
  <title>Blogs | Michele Pasin</title>


    <!-- Bootstrap core CSS -->
    
    <!-- Bootswatch:  -->
    <!-- cerulean  | cyborg |  flatly |  lumen |  sandstone |   spacelab  |  yeti | cosmo |  darkly |  paper | simplex | superhero |  journal | readable  |   slate |  united -->
    <link href="../../../../../media/static/libs/bootswatch3.2/simplex/bootstrap.min.css" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="../../../../../media/static/libs/bootstrap-3.3.7-dist/css/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="../../../../../media/static/libs/bootstrap-3.3.7-dist/css/sticky-footer-navbar.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

<style type="text/css">

    .tooltip-inner {
        max-width: 200px;
        /* If max-width does not work, try using width instead */
        width: 200px; 
    }
    .lead-plus {font-size: 26.5px;}
    .label-dark {background: #2c3e50; color: white; padding: 1px;}
    .margin50 {margin-top: 50px; margin-bottom: 50px;}
    .marginb100 {margin-bottom: 100px;}

    .breadcrumbs {margin-top: 80px;}
    .namespaces {background: #ced2d6; width: 100%;}
    .footer {background-color: #3e3f3a;}
    .footer a {color: #cac0bf;}

    .margin50Top {margin-top: 50px;}
    .margin20Top {margin-top: 20px;}
    .margin50Bottom { margin-bottom: 50px;}
    .margin20Bottom { margin-bottom: 20px;}

    /*so that the d3plus tooltip panel doesnt cover the top banner*/
    .navbar {z-index: 3000;}


    .navbar-alpha {
        font-size: 65%;
        font-style: italic;
        font-weight: bold;
        color: darkgoldenrod;
    }


    .btn-xxs {
    padding: 1px 4px;
    font-size: 10px;
    line-height: 1.2;
    border-radius: 2px;
    }


    .code-example {
        overflow: auto;
        height: 400px;
    }


    #side_title a {
        color: blue;
        text-decoration: underline;

    }
    .text-dark {
        color: #5d5c5c;
        
    }


    .paragraph_embed {
      margin-top: 50px;
      margin-bottom: 20px;
    }


    .thumb-div {
      padding: 20px;

    }

    .thumbnail{
      

      

    }

    .thumb-img {
      height: 200px;

    }

    .thumb-title b {
      font-weight: bold;
      color: black;

    }



    a.project-title {
      color: black;
      font-weight: bold;
      text-decoration: none;
    }

    a.project-title:hover {
      background: indianred;
      color: white;
    }

    a.project-active {
      background: indianred;
      color: white;
    }

    .keyword {
      font-style: italic;
      color: grey;
      text-decoration: none;
      font-size: 12px;
    }

    a.paper-active {
      background: indianred;
      color: white;
    }

    a.ext_link {
      color: darkgrey;
    }

    .text-black {
      color: black;
    }

    a.sounds-active {
      background: indianred;
      color: white;
    }

    img.project-screenshots {
      margin-botton: 30px;
    }



    

    .blogentry {
      font-size: 14px;
      margin-top: 50px;
      margin-bottom: 100px;
    }

    .blogentry p:first-of-type {
      font-size: 22px;
      font-weight: bold;
      min-height: 20px;
      padding: 19px;
      margin-bottom: 20px;
      background-color: #f4f4f4;
      border: 1px solid #e3e3e3;
      border-radius: 4px;
      -webkit-box-shadow: inset 0 1px 1px rgb(0 0 0 / 5%);
      box-shadow: inset 0 1px 1px rgb(0 0 0 / 5%);
    }

    .blogentry p {
      margin-top: 40px;
      margin-bottom: 40px;
    }

    .blogentry img {
      max-width: 80%;
    }


</style>








  </head>

  <body>





    

    


<!-- Fixed navbar -->
<nav class="navbar navbar-default navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../../../../../index.html">michelepasin<sup style="color: red;">&nbsp;.org</sup></a>
    </div>
    <div id="navbar" class="collapse navbar-collapse">
      <ul class="nav navbar-nav">

        <li >
          <a href="../../../../../index.html">Projects</a></li>

        <li class="active">
            <a href="../../../../../words/index.html">Words</a></li>

       <li >
            <a href="../../../../../sounds/index.html">Sounds</a></li>

        <li >
          <a href="../../../../../events/index.html">Events</a></li>
          
          

        <li 
        
          ><a href="../../../../../about/index.html">About</a></li>

          <!-- <li>
            <a href="/blog" target="_blank">Blog</a></li> -->
            

      </ul>
    </div><!--/.nav-collapse -->

  </div>
</nav>


    








    <!-- Begin page content -->
    <div class="container">


	

  <div class="page-header">
      
      Words > Blogs > 2010 > <i>The power of django&#39;s Q objects</i>
  </div>

  <div class="container">


      <div class="row" style="margin-bottom:50px;">
          
        <div class="col-md-8">


          <p class="text-muted">Title:</p>

          <div class="lead -well">
            <h3><b>The power of django&#39;s Q objects</b></h3>
            
          </div>


          <p class="text-muted">Year:</p>

          <div class="lead -well">
            <h3>2010</h3>
          </div>


            <div class="blogentry"> 

            <p>I've been spending some time today doing research on how to best use django's Q objects. Then I did a bit of testing myself and decided to put this whole thing together for future's sake, you know, for the time when I'll find myself lost and in need some coding recipe.</p>
<p>First things first: the <strong>official documentation</strong>.</p>
<ul>
<li>Django doc: <a href="http://docs.djangoproject.com/en/dev/topics/db/queries/#complex-lookups-with-q-objects">Complex lookups with Q objects</a> The main intro</li>
<li>Django doc: <a href="http://www.djangoproject.com/documentation/models/or_lookups/">OR lookups</a> More in-depth examples</li>
</ul>
<p>Now... let's get started by resurrecting the simple model used in the <a href="http://docs.djangoproject.com/en/dev/intro/tutorial01/">django Tutorial</a>, <strong>Polls</strong>, and adding a few <strong>instances</strong> to play with:</p>
<p># ==&gt; in models.py
from django.db import models
import datetime</p>
<p>class Poll(models.Model):
        question = models.CharField(max_length=200)
        pub_date = models.DateTimeField('date published')</p>
<p># ==&gt; add some instances from the shell</p>
<blockquote>
<blockquote>
<blockquote>
<p>p = Poll(question='what shall I make for dinner', pub_date=datetime.date.today())
p.save()
p = Poll(question='what is your favourite meal?', pub_date=datetime.datetime(2009, 7, 19, 0, 0)) #one year ago
p.save()
p = Poll(question='how do you make omelettes?', pub_date=datetime.date.today())
p.save()</p>
</blockquote>
</blockquote>
</blockquote>
<h2>What are Q Objects Handy for?</h2>
<p>In a nutshell, the main reason why you might want to use them is because you need to do <strong>complex queries</strong>, for example involving OR and AND statements a the same time.</p>
<p>Imagine that you want to retrieve all polls whose question <strong>contains the word 'dinner' OR 'meal'</strong>. The usual 'filter' option lets you do the following:</p>
<p>>&gt;&gt; Poll.objects.filter(question__contains='dinner').filter(question__contains='meal')
[]</p>
<p>But this is <strong>not really what we want</strong>, is it? We just got a <strong>concatenation of AND</strong> statements (= all constraints need to be satisfied), while <strong>we wanted an OR</strong> (=at least one of the constraints needs to be satisfied). This is where Q objects become useful:</p>
<p>>&gt;&gt; from django.db.models import Q
# a simple query</p>
<blockquote>
<blockquote>
<blockquote>
<p>Poll.objects.filter(Q(question__contains='dinner'))
[<Poll: what shall I make **for** dinner>]
# two constraints linked by AND
Poll.objects.filter(Q(question__contains='dinner') &amp; Q(question__contains='meal'))
[]
# two constraints linked by OR - that's it!
Poll.objects.filter(Q(question__contains='dinner') | Q(question__contains='meal'))
[<Poll: what shall I make **for** dinner>, <Poll: what **is** your favourite meal?>]</p>
</blockquote>
</blockquote>
</blockquote>
<p>Note that if you don't specify any logical connector the Q sequence is implicitly interpreted as AND:</p>
<p># no logical connector is interpreted as AND</p>
<blockquote>
<blockquote>
<blockquote>
<p>Poll.objects.filter(Q(question__contains='dinner'), Q(question__contains='meal'))
[]</p>
</blockquote>
</blockquote>
</blockquote>
<p>Things start getting more interesting when creating complex queries:</p>
<p># eg (A OR B) AND C:</p>
<blockquote>
<blockquote>
<blockquote>
<p>Poll.objects.filter((Q(question__contains='dinner') | Q(question__contains='meal')) &amp; Q(pub_date=datetime.date.today()))
[<Poll: what shall I make **for** dinner>]</p>
</blockquote>
</blockquote>
</blockquote>
<h2>Dynamic Query Building</h2>
<p>Now, it is likely that you want to build up queries like the ones above dynamically. This is another place where Q objects can save lots of time....for example, when constructing <strong>search engines</strong> or <strong>faceted browsers</strong> where the interface lets a user <strong>accumulate search filters</strong> in an incremental manner.</p>
<p>One way to handle this situation is by creating <strong>lists of Q objects</strong>, and then <strong>combining them together</strong> using python's <a href="http://docs.python.org/library/operator.html#operator.and_">operator</a> and <a href="http://docs.python.org/library/functions.html#reduce">reduce</a> methods:</p>
<p>>&gt;&gt; import operator
# create a list of Q objects</p>
<blockquote>
<blockquote>
<blockquote>
<p>mylist = [Q(question__contains='dinner'), Q(question__contains='meal')]
# OR
Poll.objects.filter(reduce(operator.or_, mylist))
[<Poll: what shall I make **for** dinner>, <Poll: what **is** your favourite meal?>]
# AND
Poll.objects.filter(reduce(operator.and_, mylist))
[]</p>
</blockquote>
</blockquote>
</blockquote>
<p>Now, if you're building the query dynamically you probably won't know in advance which are the filters you have to use. It is likely instead that you find yourself having to <strong>generate a list of Q objects programatically</strong> from a list of strings representing queries to your models:</p>
<p># string representation of our queries</p>
<blockquote>
<blockquote>
<blockquote>
<p>predicates = [('question__contains', 'dinner'), ('question__contains', 'meal')]
# create the list of Q objects and run the queries as above..
q_list = [Q(x) <strong>for</strong> x <strong>in</strong> predicates]
Poll.objects.filter(reduce(operator.or_, q_list))
[<Poll: what shall I make **for** dinner>, <Poll: what **is** your favourite meal?>]
Poll.objects.filter(reduce(operator.and_, q_list))
[]</p>
</blockquote>
</blockquote>
</blockquote>
<p># now let's append another filter to the query-strings..</p>
<blockquote>
<blockquote>
<blockquote>
<p>predicates.append(('pub_date', datetime.date.today()))
predicates
[('question__contains', 'dinner'), ('question__contains', 'meal'), ('pub_date', datetime.date(2010, 7, 19))]
# .. and the results will change too
q_list = [Q(x) <strong>for</strong> x <strong>in</strong> predicates]
Poll.objects.filter(reduce(operator.or_, q_list))
[<Poll: what shall I make **for** dinner>, <Poll: what **is** your favourite meal?>, <Poll: how do you make omelettes?>]
Poll.objects.filter(reduce(operator.and_, q_list))
[]</p>
</blockquote>
</blockquote>
</blockquote>
<h2>Query Expansion and Q Objects</h2>
<p>Using query expansion syntax you could normally do things <strong>like this</strong>:</p>
<p>>&gt;&gt; mydict = {'question__contains': 'omelette', 'pub_date' : datetime.date.today()}</p>
<blockquote>
<blockquote>
<blockquote>
<p>Poll.objects.filter(**mydict)
[<Poll: how do you make omelettes?>]</p>
</blockquote>
</blockquote>
</blockquote>
<p>Here you are basically <strong>sequencing AND statements which are built dynamically</strong> from some string values.</p>
<p>A really cool feature of django ORM is that you can <strong>keep doing this</strong> even <strong>while using Q objects</strong>. In other words, you can delegate all the 'normal' stuff to the query expansion mechanism, while instead resorting to Q objects whenever you need more complex queries, such an OR statement.</p>
<p>For example (remember to put the dictionary always in second position):</p>
<p># OR plus query expansion</p>
<blockquote>
<blockquote>
<blockquote>
<p>Poll.objects.filter(reduce(operator.or_, q_list), **mydict)
[<Poll: how do you make omelettes?>]
# AND plus query expansion
Poll.objects.filter(reduce(operator.and_, q_list), **mydict)
[]</p>
</blockquote>
</blockquote>
</blockquote>
<p>In the <strong>first</strong> case, we have one result only because, although the OR constraint on <em>q_list</em> is would match more stuff by itself, <em>**mydict</em> is exploded as a series of constraints connected by AND, thus making <em>[Poll: how do you make omelettes?]</em> the only matchable object. In the <strong>second</strong> case instead there are no results at all simply because we are asking for a Poll instance that satisfies simultaneously all the constraints (which doesn't exist)!</p>
<h2>Other Resources</h2>
<p>That's all for now! As I said, I found quite a <strong>few very good posts</strong> about the subject online and I strongly advise you to <strong>check them out too</strong> in order to have a clearer picture of how Q objects work.</p>
<ul>
<li><a href="http://bradmontgomery.blogspot.com/2009/06/adding-q-objects-in-django.html">Adding Q objects in Django</a> Shows another method to chain Q objects together using 'add'</li>
<li><a href="http://jehiah.cz/archive/django-q-objects">A Tip on Complex Django Queries</a> Discusses how queries need to be written in order to produce the expected mySQL code</li>
<li><a href="http://www.djangozen.com/blog/the-power-of-q">The power of Q</a> Really nice article that overviews all the major features of Q objects (and, or, negation, picking)</li>
<li><a href="http://www.nomadjourney.com/2009/04/dynamic-django-queries-with-kwargs/">Dynamic Django queries (or why kwargs is your friend)</a> Overview of dynamic querying with django</li>
</ul>

            </div>


          <hr>
            <p class="text-muted">Cite this article:</p>

            <div class="well well-big lead">
              Michele Pasin. <a href="index.html" class="bluelink">The power of django&#39;s Q objects</a>. Blog post on www.michelepasin.org. Published on July 20, 2010.
            </div>
            <br />

        


          <br /><br />


        </div> 
        
      

        <div class="col-md-1 col-md-offset-1">


            
            <p class="text-muted">Linkout:</p>

            <div class="-lead">

              
              <li><a href="https://www.michelepasin.org/blog/2010/07/20/the-power-of-djangos-q-objects/index.html">Legacy Blog</a></li>
                
              

            </div>
            <br />
            


        </div>
        
      </div>




      

      





    <div class="row">
      <h5 class="text-muted">See also:</h5>
      </div>


      

      <div class="row row_pubitem">

        <hr>

        <div class="col-sm-2 col-md-3">
          <p style="color: lightgrey; font-size: 300%; ">2010</p>
        </div>


        <div class="col-sm-7 col-md-9">


        

        <br />

          <div class='pubitem'>

            <small class="text-muted">Nov 2010</small>

            <p class='lead' style="font-size: 13px;">
              <a href="../../../11/17/preloading-stuff-in-djangos-interactive-shell/index.html" class="bluelink ">Preloading stuff in django&#39;s interactive shell</a>.
              <br />
              <span class="">Michele Pasin</span>
            </p>

            <p class="pubinfo text-muted" style="margin-top: -15px;">

              
                <span class='journal'> Blog entry on www.michelepasin.org .,</span>
              
              
              
              
                <span class='pubdate'> Nov 2010.</span>
              
              
              
              
              

            </p>

            
              <hr>
            


          </div>

        

        <br />

          <div class='pubitem'>

            <small class="text-muted">Jul 2010</small>

            <p class='lead' style="font-size: 13px;">
              <a href="index.html" class="bluelink paper-active">The power of django&#39;s Q objects</a>.
              <br />
              <span class="">Michele Pasin</span>
            </p>

            <p class="pubinfo text-muted" style="margin-top: -15px;">

              
                <span class='journal'> Blog entry on www.michelepasin.org .,</span>
              
              
              
              
                <span class='pubdate'> Jul 2010.</span>
              
              
              
              
              

            </p>

            


          </div>

        


        </div>



      </div>

      

      <div class="row row_pubitem">

        <hr>

        <div class="col-sm-2 col-md-3">
          <p style="color: lightgrey; font-size: 300%; ">2009</p>
        </div>


        <div class="col-sm-7 col-md-9">


        

        <br />

          <div class='pubitem'>

            <small class="text-muted">May 2009</small>

            <p class='lead' style="font-size: 13px;">
              <a href="../../../../2009/05/18/python-pitfall-passing-mutable-objects-as-default-args/index.html" class="bluelink ">Python pitfall: Passing Mutable Objects as Default Args</a>.
              <br />
              <span class="">Michele Pasin</span>
            </p>

            <p class="pubinfo text-muted" style="margin-top: -15px;">

              
                <span class='journal'> Blog entry on www.michelepasin.org .,</span>
              
              
              
              
                <span class='pubdate'> May 2009.</span>
              
              
              
              
              

            </p>

            


          </div>

        


        </div>



      </div>

      








    <div class="row" style="margin-top: 60px;">
    &nbsp;
    </div> 
    



  </div> <!-- /container -->





	</div>


  



  




  <footer class="footer">
    <div class="container">
    
      <p class="text-muted">Find me also on: &nbsp;
      

  <a href="http://kcl.academia.edu/MichelePasin" target="_blank">Academia</a> | 
  <a href="https://github.com/lambdamusic" target="_blank">GitHub</a> | 
  <a href="https://scholar.google.com/citations?user=zj-99x0AAAAJ&hl=en" target="_blank">Google Scholar</a> | 
  <a href="https://www.instagram.com/lambdamusic/" target="_blank">Instagram</a> |
  <a href="http://www.linkedin.com/pub/michele-pasin/1/223/a0" target="_blank">LinkedIn</a> |
  <a href="http://www.mendeley.com/profiles/michele-pasin/" target="_blank">Mendeley</a> |
  <a href="http://orcid.org/0000-0001-8909-7766" target="_blank">Orcid</a> |
  <a href="http://www.slideshare.net/mpasin" target="_blank">SlideShare</a> |
  <a href="https://soundcloud.com/magicrebirth" target="_blank">Soundcloud</a> |
  <a href="http://stackoverflow.com/users/109304/magicrebirth" target="_blank">StackOverflow</a> |
  <a href="http://twitter.com/#!/lambdaman" target="_blank">Twitter</a> |
  <a href="https://vimeo.com/lambdamusic" target="_blank">Vimeo</a>
      
      </p>
    
    </div>
  </footer>


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../../../../../media/static/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="../../../../../media/static/libs/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../../../../../media/static/libs/bootstrap-3.3.7-dist/js/ie10-viewport-bug-workaround.js"></script>


    



    

  </body>
</html>
