




<!DOCTYPE html>
<html lang="en">
  <head>



    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.3/d3.min.js"></script>


    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../../../../media/static/favicon.ico">

	
  <title>Blogs | Michele Pasin</title>


    <!-- Bootstrap core CSS -->
    
    <!-- Bootswatch:  -->
    <!-- cerulean  | cyborg |  flatly |  lumen |  sandstone |   spacelab  |  yeti | cosmo |  darkly |  paper | simplex | superhero |  journal | readable  |   slate |  united -->
    <link href="../../../../../media/static/libs/bootswatch3.2/simplex/bootstrap.min.css" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="../../../../../media/static/libs/bootstrap-3.3.7-dist/css/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="../../../../../media/static/libs/bootstrap-3.3.7-dist/css/sticky-footer-navbar.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

<style type="text/css">

    .tooltip-inner {
        max-width: 200px;
        /* If max-width does not work, try using width instead */
        width: 200px; 
    }
    .lead-plus {font-size: 26.5px;}
    .label-dark {background: #2c3e50; color: white; padding: 1px;}
    .margin50 {margin-top: 50px; margin-bottom: 50px;}
    .marginb100 {margin-bottom: 100px;}

    .breadcrumbs {margin-top: 80px;}
    .namespaces {background: #ced2d6; width: 100%;}
    .footer {background-color: #3e3f3a;}
    .footer a {color: #cac0bf;}

    .margin50Top {margin-top: 50px;}
    .margin20Top {margin-top: 20px;}
    .margin50Bottom { margin-bottom: 50px;}
    .margin20Bottom { margin-bottom: 20px;}

    /*so that the d3plus tooltip panel doesnt cover the top banner*/
    .navbar {z-index: 3000;}


    .navbar-alpha {
        font-size: 65%;
        font-style: italic;
        font-weight: bold;
        color: darkgoldenrod;
    }


    .btn-xxs {
    padding: 1px 4px;
    font-size: 10px;
    line-height: 1.2;
    border-radius: 2px;
    }


    .code-example {
        overflow: auto;
        height: 400px;
    }


    #side_title a {
        color: blue;
        text-decoration: underline;

    }
    .text-dark {
        color: #5d5c5c;
        
    }


    .paragraph_embed {
      margin-top: 50px;
      margin-bottom: 20px;
    }


    .thumb-div {
      padding: 20px;

    }

    .thumbnail{
      

      

    }

    .thumb-img {
      height: 200px;

    }

    .thumb-title b {
      font-weight: bold;
      color: black;

    }



    a.project-title {
      color: black;
      font-weight: bold;
      text-decoration: none;
    }

    a.project-title:hover {
      background: indianred;
      color: white;
    }

    a.project-active {
      background: indianred;
      color: white;
    }

    .keyword {
      font-style: italic;
      color: grey;
      text-decoration: none;
      font-size: 12px;
    }

    a.paper-active {
      background: indianred;
      color: white;
    }

    a.ext_link {
      color: darkgrey;
    }

    .text-black {
      color: black;
    }

    a.sounds-active {
      background: indianred;
      color: white;
    }

    img.project-screenshots {
      margin-botton: 30px;
    }



    

    .blogentry {
      font-size: 14px;
      margin-top: 50px;
      margin-bottom: 100px;
    }

    .blogentry p:first-of-type {
      font-size: 22px;
      font-weight: bold;
      min-height: 20px;
      padding: 19px;
      margin-bottom: 20px;
      background-color: #f4f4f4;
      border: 1px solid #e3e3e3;
      border-radius: 4px;
      -webkit-box-shadow: inset 0 1px 1px rgb(0 0 0 / 5%);
      box-shadow: inset 0 1px 1px rgb(0 0 0 / 5%);
    }

    .blogentry p {
      margin-top: 40px;
      margin-bottom: 40px;
    }

    .blogentry img {
      max-width: 80%;
    }


</style>








  </head>

  <body>





    

    


<!-- Fixed navbar -->
<nav class="navbar navbar-default navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../../../../../index.html">michelepasin<sup style="color: red;">&nbsp;.org</sup></a>
    </div>
    <div id="navbar" class="collapse navbar-collapse">
      <ul class="nav navbar-nav">

        <li >
          <a href="../../../../../index.html">Projects</a></li>

        <li class="active">
            <a href="../../../../../words/index.html">Words</a></li>

       <li >
            <a href="../../../../../sounds/index.html">Sounds</a></li>

        <li >
          <a href="../../../../../events/index.html">Events</a></li>
          
          

        <li 
        
          ><a href="../../../../../about/index.html">About</a></li>

          <!-- <li>
            <a href="/blog" target="_blank">Blog</a></li> -->
            

      </ul>
    </div><!--/.nav-collapse -->

  </div>
</nav>


    








    <!-- Begin page content -->
    <div class="container">


	

  <div class="page-header">
      
      Words > Blogs > 2010 > <i>Preloading stuff in django&#39;s interactive shell</i>
  </div>

  <div class="container">


      <div class="row" style="margin-bottom:50px;">
          
        <div class="col-md-8">


          <p class="text-muted">Title:</p>

          <div class="lead -well">
            <h3><b>Preloading stuff in django&#39;s interactive shell</b></h3>
            
          </div>


          <p class="text-muted">Year:</p>

          <div class="lead -well">
            <h3>2010</h3>
          </div>


            <div class="blogentry"> 

            <p><a href="http://docs.djangoproject.com/en/dev/ref/django-admin/#shell">Django's shell</a> is a fantastic way to interact with all the components of your django application, eg when testing new functionalities or debugging a nasty error. Sometimes though you end up loading the same variables or importing the same modules every time you run the shell , for example because you are trying out a large function that needs being refined through a trial and error process.</p>
<p>Opening up the shell and reloading all the components you need to have handy can thus become a bit tedious; here's an easy way to go around this problem. In doing this, I've just been inspired some code found in the handy <a href="https://github.com/django-extensions/django-extensions">django-extensions</a> app. The extensions ship with a number of <a href="http://code.google.com/p/django-command-extensions/wiki/CommandExtensions">command modules</a>, that is, functions that you can run from the unix shell using the usual <em>python manage.py some_command</em> syntax.</p>
<p>The module I'm talking about here is called <strong>shell_plus</strong> - it's an enhanced version of the Django shell. It will autoload all your models making it easy to work with the ORM right away. Here's the implementation:</p>
<p># django_extensions/management/commands/shell_plus.py  </p>
<p>import os<br />
from django.core.management.base import NoArgsCommand<br />
from optparse import make_option  </p>
<p>class Command(NoArgsCommand):<br />
    option_list = NoArgsCommand.option_list + (<br />
        make_option('--plain', action='store_true', dest='plain',<br />
            help\='Tells Django to use plain Python, not IPython.'),<br />
        make_option('--no-pythonrc', action='store_true', dest='no_pythonrc',<br />
            help\='Tells Django to use plain Python, not IPython.'),<br />
    )<br />
    help = "Like the 'shell' command but autoloads the models of all installed Django apps."  </p>
<p>requires_model_validation = True  </p>
<p>def handle_noargs(self, **options):<br />
        # XXX: (Temporary) workaround for ticket #1796: force early loading of all<br />
        # models from installed apps. (this is fixed by now, but leaving it here<br />
        # for people using 0.96 or older trunk (pre [5919]) versions.<br />
        from django.db.models.loading import get_models, get_apps<br />
        loaded_models = get_models()  </p>
<p>use_plain = options.get('plain', False)<br />
        use_pythonrc = not options.get('no_pythonrc', True)  </p>
<p># Set up a dictionary to serve as the environment for the shell, so<br />
        # that tab completion works on objects that are imported at runtime.<br />
        # See ticket 5082. 
        from django.conf import settings<br />
        imported_objects = {'settings': settings}<br />
        for app_mod in get_apps():<br />
            app_models = get_models(app_mod)<br />
            if not app_models:<br />
                continue<br />
            model_labels = ", ".join([model.__name__ for model in app_models])<br />
            print self.style.SQL_COLTYPE("From '%s' autoload: %s" % (app_mod.__name__.split('.')[-2], model_labels))<br />
            for model in app_models:<br />
                try:<br />
                    imported_objects[model.__name__] = getattr(__import__(app_mod.__name__, {}, {}, model.__name__), model.__name__)<br />
                except AttributeError, e:<br />
                    print self.style.ERROR_OUTPUT("Failed to import '%s' from '%s' reason: %s" % (model.__name__, app_mod.__name__.split('.')[-2], str(e)))<br />
                    continue<br />
        try:<br />
            if use_plain:<br />
                # Don't bother loading IPython, because the user wants plain Python.<br />
                raise ImportError<br />
            import IPython<br />
            # Explicitly pass an empty list as arguments, because otherwise IPython<br />
            # would use sys.argv from this script.<br />
            shell = IPython.Shell.IPShell(argv=[], user_ns=imported_objects)<br />
            shell.mainloop()<br />
        except ImportError:<br />
            # Using normal Python shell<br />
            import code<br />
            try: # Try activating rlcompleter, because it's handy.<br />
                import readline<br />
            except ImportError:<br />
                pass<br />
            else:<br />
                # We don't have to wrap the following import in a 'try', because<br />
                # we already know 'readline' was imported successfully.<br />
                import rlcompleter<br />
                readline.set_completer(rlcompleter.Completer(imported_objects).complete)<br />
                readline.parse_and_bind("tab:complete")  </p>
<p># We want to honor both $PYTHONSTARTUP and .pythonrc.py, so follow system<br />
            # conventions and get $PYTHONSTARTUP first then import user.<br />
            if use_pythonrc:<br />
                pythonrc = os.environ.get("PYTHONSTARTUP")<br />
                if pythonrc and os.path.isfile(pythonrc):<br />
                    try:<br />
                        execfile(pythonrc)<br />
                    except NameError:<br />
                        pass<br />
                # This will import .pythonrc.py as a side-effect<br />
                import user<br />
            code.interact(local=imported_objects)</p>
<p>Essentially, this is what's going on here:</p>
<p>a. A <strong>subclass of NoArgsCommand is created</strong> following the standard approach stated in Django's <a href="http://docs.djangoproject.com/en/dev/howto/custom-management-commands/">docs for creating custom management commands</a> .</p>
<p>b. All the <strong>applications</strong> in your django project and the related <strong>models</strong> get <strong>loaded</strong>, and their references are added to the <strong>imported_objects</strong> dictionary, eg when the code reads:</p>
<p>```</p>
<p>imported_objects = {'settings': settings}
```</p>
<p>c. The code tries to <strong>load the best python shell</strong> available: iPython if present, otherwise the normal python shell with the necessary libraries are called.</p>
<p>...</p>
<p>That's all. The key line to look at is therefore the last one, that is:</p>
<p>```</p>
<h1>.......</h1>
<p>code.interact(local=imported_objects)
```</p>
<p>That's what launches the interpreter and initializes it with the <em><strong>imported_objects</strong></em> dictionary; this dictionary contains all the (extra) symbols that we want to make available through the new python interpreter instance. So in order to have more stuff there all we have to do is add more elements to that dictionary, eg:</p>
<p>```</p>
<h1>.......</h1>
<p>alist = range(1000)
imported_objects['alist'] = alist
code.interact(local=imported_objects)
```</p>
<p>Insert these two lines right before the last line of the script above, save it using a new name (eg. <em>my_fancyshell.py</em> )in the <em>/management/commands/</em> directory of one of your applications (it needs to be there so that django interprets it as a custom command), and the game is done. Now you can invoke</p>
<p>```</p>
<p>bash-3.2$ python manage.py my_fancyshell.py
```</p>
<p>from the unix command line, and the 'alist' symbol will be available. Obviously in a real world situation you might end up loading and adding to the <em>imported_objects</em> dictionary various many things too, but the principle will remain the same!</p>
<p>...</p>

            </div>


          <hr>
            <p class="text-muted">Cite this article:</p>

            <div class="well well-big lead">
              Michele Pasin. <a href="index.html" class="bluelink">Preloading stuff in django&#39;s interactive shell</a>. Blog post on www.michelepasin.org. Published on Nov. 17, 2010.
            </div>
            <br />

        


          <br /><br />


        </div> 
        
      

        <div class="col-md-1 col-md-offset-1">


            
            <p class="text-muted">Linkout:</p>

            <div class="-lead">

              
              <li><a href="https://www.michelepasin.org/blog/2010/11/17/preloading-stuff-in-djangos-interactive-shell/index.html">Legacy Blog</a></li>
                
              

            </div>
            <br />
            


        </div>
        
      </div>




      

      





    <div class="row">
      <h5 class="text-muted">See also:</h5>
      </div>


      

      <div class="row row_pubitem">

        <hr>

        <div class="col-sm-2 col-md-3">
          <p style="color: lightgrey; font-size: 300%; ">2019</p>
        </div>


        <div class="col-sm-7 col-md-9">


        

        <br />

          <div class='pubitem'>

            <small class="text-muted">May 2019</small>

            <p class='lead' style="font-size: 13px;">
              <a href="../../../../2019/05/03/running-jupyter-demos-via-mybinder-org/index.html" class="bluelink ">Running interactive Jupyter demos with  mybinder.org</a>.
              <br />
              <span class="">Michele Pasin</span>
            </p>

            <p class="pubinfo text-muted" style="margin-top: -15px;">

              
                <span class='journal'> Blog entry on www.michelepasin.org .,</span>
              
              
              
              
                <span class='pubdate'> May 2019.</span>
              
              
              
              
              

            </p>

            


          </div>

        


        </div>



      </div>

      

      <div class="row row_pubitem">

        <hr>

        <div class="col-sm-2 col-md-3">
          <p style="color: lightgrey; font-size: 300%; ">2014</p>
        </div>


        <div class="col-sm-7 col-md-9">


        

        <br />

          <div class='pubitem'>

            <small class="text-muted">Oct 2014</small>

            <p class='lead' style="font-size: 13px;">
              <a href="../../../../2014/10/12/interactive-turtle-shell/index.html" class="bluelink ">An interactive Turtle shell</a>.
              <br />
              <span class="">Michele Pasin</span>
            </p>

            <p class="pubinfo text-muted" style="margin-top: -15px;">

              
                <span class='journal'> Blog entry on www.michelepasin.org .,</span>
              
              
              
              
                <span class='pubdate'> Oct 2014.</span>
              
              
              
              
              

            </p>

            


          </div>

        


        </div>



      </div>

      

      <div class="row row_pubitem">

        <hr>

        <div class="col-sm-2 col-md-3">
          <p style="color: lightgrey; font-size: 300%; ">2011</p>
        </div>


        <div class="col-sm-7 col-md-9">


        

        <br />

          <div class='pubitem'>

            <small class="text-muted">Jan 2011</small>

            <p class='lead' style="font-size: 13px;">
              <a href="../../../../2011/01/07/the-digital-story-of-nativity-and-other-inspiring-stuff/index.html" class="bluelink ">The Digital Story of Nativity and other inspiring stuff</a>.
              <br />
              <span class="">Michele Pasin</span>
            </p>

            <p class="pubinfo text-muted" style="margin-top: -15px;">

              
                <span class='journal'> Blog entry on www.michelepasin.org .,</span>
              
              
              
              
                <span class='pubdate'> Jan 2011.</span>
              
              
              
              
              

            </p>

            


          </div>

        


        </div>



      </div>

      

      <div class="row row_pubitem">

        <hr>

        <div class="col-sm-2 col-md-3">
          <p style="color: lightgrey; font-size: 300%; ">2010</p>
        </div>


        <div class="col-sm-7 col-md-9">


        

        <br />

          <div class='pubitem'>

            <small class="text-muted">Nov 2010</small>

            <p class='lead' style="font-size: 13px;">
              <a href="index.html" class="bluelink paper-active">Preloading stuff in django&#39;s interactive shell</a>.
              <br />
              <span class="">Michele Pasin</span>
            </p>

            <p class="pubinfo text-muted" style="margin-top: -15px;">

              
                <span class='journal'> Blog entry on www.michelepasin.org .,</span>
              
              
              
              
                <span class='pubdate'> Nov 2010.</span>
              
              
              
              
              

            </p>

            
              <hr>
            


          </div>

        

        <br />

          <div class='pubitem'>

            <small class="text-muted">Jul 2010</small>

            <p class='lead' style="font-size: 13px;">
              <a href="../../../07/20/the-power-of-djangos-q-objects/index.html" class="bluelink ">The power of django&#39;s Q objects</a>.
              <br />
              <span class="">Michele Pasin</span>
            </p>

            <p class="pubinfo text-muted" style="margin-top: -15px;">

              
                <span class='journal'> Blog entry on www.michelepasin.org .,</span>
              
              
              
              
                <span class='pubdate'> Jul 2010.</span>
              
              
              
              
              

            </p>

            
              <hr>
            


          </div>

        

        <br />

          <div class='pubitem'>

            <small class="text-muted">Mar 2010</small>

            <p class='lead' style="font-size: 13px;">
              <a href="../../../03/11/tale-of-tales-artistic-interactive-games-from-belgium/index.html" class="bluelink ">Tale of tales: artistic interactive games from Belgium</a>.
              <br />
              <span class="">Michele Pasin</span>
            </p>

            <p class="pubinfo text-muted" style="margin-top: -15px;">

              
                <span class='journal'> Blog entry on www.michelepasin.org .,</span>
              
              
              
              
                <span class='pubdate'> Mar 2010.</span>
              
              
              
              
              

            </p>

            
              <hr>
            


          </div>

        

        <br />

          <div class='pubitem'>

            <small class="text-muted">Mar 2010</small>

            <p class='lead' style="font-size: 13px;">
              <a href="../../../03/05/bbc-article-on-interactive-art-at-goldsmith-university-london/index.html" class="bluelink ">BBC article on interactive art at Goldsmith University (London)</a>.
              <br />
              <span class="">Michele Pasin</span>
            </p>

            <p class="pubinfo text-muted" style="margin-top: -15px;">

              
                <span class='journal'> Blog entry on www.michelepasin.org .,</span>
              
              
              
              
                <span class='pubdate'> Mar 2010.</span>
              
              
              
              
              

            </p>

            


          </div>

        


        </div>



      </div>

      

      <div class="row row_pubitem">

        <hr>

        <div class="col-sm-2 col-md-3">
          <p style="color: lightgrey; font-size: 300%; ">2009</p>
        </div>


        <div class="col-sm-7 col-md-9">


        

        <br />

          <div class='pubitem'>

            <small class="text-muted">May 2009</small>

            <p class='lead' style="font-size: 13px;">
              <a href="../../../../2009/05/27/snippet-to-quickly-load-stuff-in-the-django-shell/index.html" class="bluelink ">Snippet to load stuff quickly in the Django shell</a>.
              <br />
              <span class="">Michele Pasin</span>
            </p>

            <p class="pubinfo text-muted" style="margin-top: -15px;">

              
                <span class='journal'> Blog entry on www.michelepasin.org .,</span>
              
              
              
              
                <span class='pubdate'> May 2009.</span>
              
              
              
              
              

            </p>

            


          </div>

        


        </div>



      </div>

      








    <div class="row" style="margin-top: 60px;">
    &nbsp;
    </div> 
    



  </div> <!-- /container -->





	</div>


  



  




  <footer class="footer">
    <div class="container">
    
      <p class="text-muted">Find me also on: &nbsp;
      

  <a href="http://kcl.academia.edu/MichelePasin" target="_blank">Academia</a> | 
  <a href="https://github.com/lambdamusic" target="_blank">GitHub</a> | 
  <a href="https://scholar.google.com/citations?user=zj-99x0AAAAJ&hl=en" target="_blank">Google Scholar</a> | 
  <a href="https://www.instagram.com/lambdamusic/" target="_blank">Instagram</a> |
  <a href="http://www.linkedin.com/pub/michele-pasin/1/223/a0" target="_blank">LinkedIn</a> |
  <a href="http://www.mendeley.com/profiles/michele-pasin/" target="_blank">Mendeley</a> |
  <a href="http://orcid.org/0000-0001-8909-7766" target="_blank">Orcid</a> |
  <a href="http://www.slideshare.net/mpasin" target="_blank">SlideShare</a> |
  <a href="https://soundcloud.com/magicrebirth" target="_blank">Soundcloud</a> |
  <a href="http://stackoverflow.com/users/109304/magicrebirth" target="_blank">StackOverflow</a> |
  <a href="http://twitter.com/#!/lambdaman" target="_blank">Twitter</a> |
  <a href="https://vimeo.com/lambdamusic" target="_blank">Vimeo</a>
      
      </p>
    
    </div>
  </footer>


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../../../../../media/static/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="../../../../../media/static/libs/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../../../../../media/static/libs/bootstrap-3.3.7-dist/js/ie10-viewport-bug-workaround.js"></script>


    



    

  </body>
</html>
